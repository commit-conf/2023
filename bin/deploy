#!/bin/bash

set -e

FOLDER=.gh-pages
echo "Current folder: $(pwd)"
if [ ! -d ${FOLDER} ]; then
  # this can olny be on a local environment, not on CICD
  echo "Warning: ${FOLDER} does not exist. Creating it..."
  git clone -b gh-pages git@github.com:commit-conf/2023 ${FOLDER}
  cd ${FOLDER}
else
  cd ${FOLDER}
  git pull origin gh-pages
fi

rm -rf *
rm -rf .github
cp -R ../_site/* .
git add -A
git commit -m "$(git log origin/master -1 --pretty=%B)"
git push

cd ..
echo "Successfully deployed" 